<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Menü Admin Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* Enhanced Sidebar Styles */
        .sidebar-collapsed {
            width: 0px !important;
            overflow: hidden;
            transform: translateX(-100%);
        }
        .sidebar-expanded {
            width: 280px;
            transform: translateX(0);
        }
        
        /* Content Area Styles */
        .content-expanded {
            margin-left: 0px !important;
            width: 100% !important;
        }
        .content-normal {
            margin-left: 280px;
            width: calc(100% - 280px);
        }
        
        /* Sidebar Text Visibility */
        .sidebar-text {
            opacity: 1;
            transition: opacity 0.3s ease;
            white-space: nowrap;
        }
        .sidebar-collapsed .sidebar-text {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Toggle Button Positioning */
        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .sidebar-expanded .sidebar-toggle {
            position: relative;
            top: auto;
            left: auto;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar-expanded {
                width: 100% !important;
                position: fixed !important;
                z-index: 60 !important;
                left: 0 !important;
                top: 0 !important;
                height: 100vh !important;
            }
            
            .sidebar-collapsed {
                width: 0 !important;
                left: -100% !important;
            }
            
            .content-normal,
            .content-expanded {
                margin-left: 0 !important;
                width: 100% !important;
            }
            
            .mobile-overlay {
                display: block;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 55;
            }
            
            .sidebar-toggle {
                position: fixed !important;
                top: 20px !important;
                left: 20px !important;
                z-index: 1000 !important;
                background: white !important;
                border-radius: 50% !important;
                padding: 12px !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            }
        }
        
        /* License Overlay Styles */
        .license-overlay {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            backdrop-filter: blur(10px);
        }
        .license-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .verification-step {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .verification-step.pending {
            background: #f3f4f6;
            color: #6b7280;
        }
        .verification-step.active {
            background: #dbeafe;
            color: #1d4ed8;
            border-left: 4px solid #3b82f6;
        }
        .verification-step.completed {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        .verification-step.failed {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Quick Actions */
        .quick-actions {
            position: fixed;
            bottom: 90px;
            right: 20px;
            z-index: 50;
        }
        
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
            transition: all 0.3s ease;
        }
        
        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }
        
        @media (max-width: 768px) {
            .quick-actions {
                bottom: 80px;
                right: 10px;
            }
            
            .fab {
                bottom: 10px;
                right: 10px;
                width: 48px;
                height: 48px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- License Check Overlay -->
    <div id="licenseOverlay" class="fixed inset-0 license-overlay z-50 flex items-center justify-center p-4">
        <div class="license-card rounded-2xl shadow-2xl max-w-md w-full p-8 text-center">
            <div class="mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="shield-check" class="h-10 w-10 text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Lisans Doğrulama</h2>
                <p class="text-gray-600">Sisteme erişim için lisans anahtarınızı girin</p>
            </div>
            
            <div id="licenseForm">
                <div class="mb-4">
                    <input 
                        type="text" 
                        id="licenseKey" 
                        placeholder="Lisans anahtarınızı girin..."
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center font-mono"
                        maxlength="35"
                    >
                </div>

                <!-- Enhanced Verification Steps -->
                <div id="verificationSteps" class="hidden mb-4 text-left">
                    <div id="step-format" class="verification-step pending">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="file-check" class="h-4 w-4"></i>
                            <span class="text-sm font-medium">Lisans formatı kontrol ediliyor...</span>
                        </div>
                    </div>
                    <div id="step-domain" class="verification-step pending">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="globe" class="h-4 w-4"></i>
                            <span class="text-sm font-medium">Domain yetkilendirmesi kontrol ediliyor...</span>
                        </div>
                    </div>
                    <div id="step-server" class="verification-step pending">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="server" class="h-4 w-4"></i>
                            <span class="text-sm font-medium">Uzak sunucu doğrulaması yapılıyor...</span>
                        </div>
                    </div>
                    <div id="step-integrity" class="verification-step pending">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="shield" class="h-4 w-4"></i>
                            <span class="text-sm font-medium">Güvenlik kontrolü yapılıyor...</span>
                        </div>
                    </div>
                    <div id="step-storage" class="verification-step pending">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="database" class="h-4 w-4"></i>
                            <span class="text-sm font-medium">Lisans kalıcı olarak kaydediliyor...</span>
                        </div>
                    </div>
                </div>
                
                <button 
                    onclick="verifyLicense()" 
                    id="verifyBtn"
                    class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105"
                >
                    <span id="verifyBtnText">Lisansı Doğrula</span>
                    <div id="verifySpinner" class="hidden inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"></div>
                </button>
                
                <div id="licenseError" class="hidden mt-4 p-3 bg-red-100 border border-red-300 rounded-lg text-red-700 text-sm"></div>
                <div id="licenseSuccess" class="hidden mt-4 p-3 bg-green-100 border border-green-300 rounded-lg text-green-700 text-sm"></div>
            </div>
            
            <div class="mt-6 pt-6 border-t border-gray-200">
                <p class="text-xs text-gray-500">
                    QR Menü Sistemi v2.0 - Güvenli Lisans Sistemi<br>
                    <span class="font-mono" id="domainInfo"></span>
                </p>
            </div>
        </div>
    </div>

    <!-- Admin Panel (Hidden until license verified) -->
    <div id="adminPanel" class="hidden">
        <!-- Mobile Overlay -->
        <div id="mobileOverlay" class="mobile-overlay hidden"></div>
        
        <!-- Sidebar Toggle Button -->
        <button 
            id="sidebarToggle"
            onclick="toggleSidebar()" 
            class="sidebar-toggle p-3 rounded-lg bg-white hover:bg-gray-100 transition-colors shadow-lg border border-gray-200"
            title="Sidebar'ı Aç/Kapat"
        >
            <i data-lucide="menu" class="h-6 w-6 text-gray-600"></i>
        </button>

        <!-- Sidebar -->
        <div id="sidebar" class="fixed left-0 top-0 h-full bg-white shadow-xl z-40 transition-all duration-300 sidebar-collapsed">
            <!-- Sidebar Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-200">
                <div class="flex items-center space-x-3 sidebar-text">
                    <div class="w-10 h-10 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-lg flex items-center justify-center">
                        <i data-lucide="utensils" class="h-6 w-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-900">QR Menü</h1>
                        <p class="text-xs text-gray-500">Admin Panel</p>
                    </div>
                </div>
                <button 
                    onclick="toggleSidebar()" 
                    class="p-2 rounded-lg hover:bg-gray-100 transition-colors md:hidden"
                    title="Kapat"
                >
                    <i data-lucide="x" class="h-5 w-5 text-gray-600"></i>
                </button>
            </div>

            <!-- Navigation Menu -->
            <nav class="flex-1 overflow-y-auto p-4">
                <ul class="space-y-2">
                    <li>
                        <button 
                            onclick="showSection('dashboard')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="dashboard"
                        >
                            <i data-lucide="bar-chart-3" class="h-5 w-5"></i>
                            <span class="sidebar-text">Dashboard</span>
                        </button>
                    </li>
                    <li>
                        <button 
                            onclick="showSection('products')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="products"
                        >
                            <i data-lucide="package" class="h-5 w-5"></i>
                            <span class="sidebar-text">Ürünler</span>
                        </button>
                    </li>
                    <li>
                        <button 
                            onclick="showSection('categories')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="categories"
                        >
                            <i data-lucide="folder" class="h-5 w-5"></i>
                            <span class="sidebar-text">Kategoriler</span>
                        </button>
                    </li>
                    <li>
                        <button 
                            onclick="showSection('tables')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="tables"
                        >
                            <i data-lucide="table" class="h-5 w-5"></i>
                            <span class="sidebar-text">Masalar</span>
                        </button>
                    </li>
                    <li>
                        <button 
                            onclick="showSection('qr-codes')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="qr-codes"
                        >
                            <i data-lucide="qr-code" class="h-5 w-5"></i>
                            <span class="sidebar-text">QR Kodlar</span>
                        </button>
                    </li>
                    <li>
                        <button 
                            onclick="showSection('restaurant')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="restaurant"
                        >
                            <i data-lucide="building" class="h-5 w-5"></i>
                            <span class="sidebar-text">İşletme</span>
                        </button>
                    </li>
                    <li>
                        <button 
                            onclick="showSection('design')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="design"
                        >
                            <i data-lucide="palette" class="h-5 w-5"></i>
                            <span class="sidebar-text">Tasarım</span>
                        </button>
                    </li>
                    <li>
                        <button 
                            onclick="showSection('security')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="security"
                        >
                            <i data-lucide="shield" class="h-5 w-5"></i>
                            <span class="sidebar-text">Güvenlik</span>
                        </button>
                    </li>
                    <li>
                        <button 
                            onclick="showSection('notifications')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="notifications"
                        >
                            <i data-lucide="bell" class="h-5 w-5"></i>
                            <span class="sidebar-text">Bildirimler</span>
                            <span id="notificationBadge" class="hidden bg-red-500 text-white text-xs rounded-full px-2 py-1 ml-auto">0</span>
                        </button>
                    </li>
                    <li>
                        <button 
                            onclick="showSection('feedback')" 
                            class="nav-item w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
                            data-section="feedback"
                        >
                            <i data-lucide="message-square" class="h-5 w-5"></i>
                            <span class="sidebar-text">Geri Bildirimler</span>
                        </button>
                    </li>
                </ul>
            </nav>

            <!-- Sidebar Footer - Mobile Optimized -->
            <div class="p-4 border-t border-gray-200 sidebar-text">
                <!-- Security Status -->
                <div class="mb-3 p-3 bg-green-50 border border-green-200 rounded-lg">
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-medium text-green-800">Güvenlik Durumu</p>
                            <p class="text-xs text-green-600">Sistem Güvenli</p>
                        </div>
                    </div>
                </div>

                <!-- Domain Info -->
                <div class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-medium text-blue-800">Domain</p>
                            <p class="text-xs text-blue-600 truncate" id="sidebarDomain">localhost</p>
                        </div>
                    </div>
                </div>

                <!-- License Status -->
                <div class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs font-medium text-yellow-800">Lisans</p>
                            <p class="text-xs text-yellow-600" id="sidebarLicenseStatus">Aktif</p>
                        </div>
                    </div>
                </div>

                <button 
                    onclick="logout()" 
                    class="w-full flex items-center justify-center space-x-2 px-3 py-2 bg-red-50 hover:bg-red-100 text-red-700 rounded-lg transition-colors"
                >
                    <i data-lucide="log-out" class="h-4 w-4"></i>
                    <span>Çıkış Yap</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="transition-all duration-300 content-expanded">
            <!-- Top Bar -->
            <div class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 id="pageTitle" class="text-2xl font-bold text-gray-900">Dashboard</h1>
                        <p id="pageDescription" class="text-gray-600 mt-1">Sistem genel bakış ve istatistikler</p>
                    </div>
                    <!-- Desktop only info - hidden on mobile -->
                    <div class="hidden lg:flex items-center space-x-4">
                        <div class="flex items-center space-x-2 text-sm text-gray-500">
                            <i data-lucide="globe" class="h-4 w-4"></i>
                            <span id="currentDomain">localhost</span>
                        </div>
                        <div class="flex items-center space-x-2 text-sm text-green-600">
                            <i data-lucide="shield-check" class="h-4 w-4"></i>
                            <span>Lisans Aktif</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="p-6">
                <div id="contentArea">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Audio for notifications -->
<audio id="notificationSound" preload="auto">
    <source src="https://vudolix.com/test1/admin/sound.wav" type="audio/wav" />
</audio>

<script>
    const audio = document.getElementById("notificationSound");
    let playCount = 0;
    const maxPlays = 3;

    audio.addEventListener("ended", () => {
        playCount++;
        if (playCount < maxPlays) {
            audio.play();
        }
    });

    // İlk çalma
    audio.play();
</script>


        <!-- Quick Actions FAB -->
        <!--
        <button id="fabButton" onclick="toggleQuickActions()" class="fab" title="Hızlı İşlemler">
             <i data-lucide="plus" class="h-6 w-6"></i>
        </button>
        -->

        <!-- Quick Actions Menu -->
        <div id="quickActions" class="quick-actions hidden">
            <div class="flex flex-col space-y-3">
                <div class="quick-action-item">
                    <button onclick="scrollToSection('add-product')" class="w-12 h-12 bg-blue-500 hover:bg-blue-600 text-white rounded-full shadow-lg transition-all" title="Ürün Ekle">
                        <i data-lucide="package-plus" class="h-5 w-5 mx-auto"></i>
                    </button>
                </div>
                <div class="quick-action-item">
                    <button onclick="scrollToSection('add-category')" class="w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full shadow-lg transition-all" title="Kategori Ekle">
                        <i data-lucide="folder-plus" class="h-5 w-5 mx-auto"></i>
                    </button>
                </div>
                <div class="quick-action-item">
                    <button onclick="scrollToSection('edit-products')" class="w-12 h-12 bg-purple-500 hover:bg-purple-600 text-white rounded-full shadow-lg transition-all" title="Ürün Düzenle">
                        <i data-lucide="edit" class="h-5 w-5 mx-auto"></i>
                    </button>
                </div>
                <div class="quick-action-item">
                    <button onclick="scrollToSection('security-dashboard')" class="w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full shadow-lg transition-all" title="Güvenlik">
                        <i data-lucide="shield" class="h-5 w-5 mx-auto"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="../admin.js"></script>
    <script src="enhanced-license-system.js"></script>
    <script src="security-dashboard.js"></script>
    <script>
        // Global variables
        let quickActionsVisible = false;

        // Initialize license check on page load
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            document.getElementById('domainInfo').textContent = window.location.hostname;
            document.getElementById('currentDomain').textContent = window.location.hostname;
            document.getElementById('sidebarDomain').textContent = window.location.hostname;
            
            // Check if license is already verified
            checkExistingLicense();
            
            // Setup mobile overlay click handler
            document.getElementById('mobileOverlay').addEventListener('click', closeSidebar);
        });

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const isMobile = window.innerWidth <= 768;
            
            if (sidebar.classList.contains('sidebar-expanded')) {
                // Close sidebar
                sidebar.classList.remove('sidebar-expanded');
                sidebar.classList.add('sidebar-collapsed');
                mainContent.classList.remove('content-normal');
                mainContent.classList.add('content-expanded');
                
                if (isMobile) {
                    mobileOverlay.classList.add('hidden');
                }
            } else {
                // Open sidebar
                sidebar.classList.remove('sidebar-collapsed');
                sidebar.classList.add('sidebar-expanded');
                mainContent.classList.remove('content-expanded');
                mainContent.classList.add('content-normal');
                
                if (isMobile) {
                    mobileOverlay.classList.remove('hidden');
                }
            }
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const mobileOverlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.remove('sidebar-expanded');
            sidebar.classList.add('sidebar-collapsed');
            mainContent.classList.remove('content-normal');
            mainContent.classList.add('content-expanded');
            mobileOverlay.classList.add('hidden');
        }

        function toggleQuickActions() {
            const quickActions = document.getElementById('quickActions');
            const fabIcon = document.querySelector('#fabButton i');
            
            if (quickActionsVisible) {
                quickActions.classList.add('hidden');
                fabIcon.setAttribute('data-lucide', 'plus');
                quickActionsVisible = false;
            } else {
                quickActions.classList.remove('hidden');
                fabIcon.setAttribute('data-lucide', 'x');
                quickActionsVisible = true;
            }
            
            lucide.createIcons();
        }

        function scrollToSection(sectionId) {
            // Close quick actions
            if (quickActionsVisible) {
                toggleQuickActions();
            }
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                closeSidebar();
            }
            
            // Scroll to section with smooth animation
            setTimeout(() => {
                const element = document.getElementById(sectionId);
                if (element) {
                    element.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start',
                        inline: 'nearest'
                    });
                    
                    // Add highlight effect
                    element.classList.add('ring-2', 'ring-yellow-400', 'ring-opacity-75');
                    setTimeout(() => {
                        element.classList.remove('ring-2', 'ring-yellow-400', 'ring-opacity-75');
                    }, 2000);
                }
            }, 100);
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const isMobile = window.innerWidth <= 768;
            
            if (!isMobile && sidebar.classList.contains('sidebar-expanded')) {
                // Desktop mode - remove mobile overlay
                mobileOverlay.classList.add('hidden');
            }
        });

        async function checkExistingLicense() {
            try {
                const licenseManager = window.SecureLicenseManager;
                if (licenseManager && licenseManager.isLicenseValid()) {
                    showAdminPanel();
                    return;
                }
            } catch (error) {
                console.error('License validation error:', error);
            }
            
            // Show license form
            const overlay = document.getElementById('licenseOverlay');
            if (overlay) {
                overlay.classList.remove('hidden');
            }
        }

        async function verifyLicense() {
            const licenseKey = document.getElementById('licenseKey').value.trim();
            const verifyBtn = document.getElementById('verifyBtn');
            const verifyBtnText = document.getElementById('verifyBtnText');
            const verifySpinner = document.getElementById('verifySpinner');
            const errorDiv = document.getElementById('licenseError');
            const successDiv = document.getElementById('licenseSuccess');
            const verificationSteps = document.getElementById('verificationSteps');

            if (!licenseKey) {
                showLicenseError('Lütfen lisans anahtarınızı girin.');
                return;
            }

            // Show loading state
            verifyBtn.disabled = true;
            verifyBtnText.textContent = 'Doğrulanıyor...';
            verifySpinner.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
            verificationSteps.classList.remove('hidden');

            try {
                // Step 1: Format validation
                updateVerificationStep('step-format', 'active');
                await delay(800);
                
                if (!validateLicenseFormat(licenseKey)) {
                    updateVerificationStep('step-format', 'failed');
                    throw new Error('Geçersiz lisans anahtarı formatı.');
                }
                updateVerificationStep('step-format', 'completed');

                // Step 2: Domain check
                updateVerificationStep('step-domain', 'active');
                await delay(500);
                updateVerificationStep('step-domain', 'completed');

                // Step 3: Server verification
                updateVerificationStep('step-server', 'active');
                await delay(1000);
                
                const licenseManager = window.SecureLicenseManager;
                const result = await licenseManager.verifyLicense(licenseKey);
                
                if (!result.success) {
                    updateVerificationStep('step-server', 'failed');
                    throw new Error('Uzak sunucu doğrulaması başarısız.');
                }
                updateVerificationStep('step-server', 'completed');

                // Step 4: Security check
                updateVerificationStep('step-integrity', 'active');
                await delay(500);
                updateVerificationStep('step-integrity', 'completed');

                // Step 5: Storage
                updateVerificationStep('step-storage', 'active');
                await delay(500);
                updateVerificationStep('step-storage', 'completed');

                successDiv.textContent = 'Lisans başarıyla doğrulandı ve kalıcı olarak kaydedildi! Yönlendiriliyorsunuz...';
                successDiv.classList.remove('hidden');
                
                setTimeout(() => {
                    showAdminPanel();
                }, 1500);

            } catch (error) {
                console.error('License verification error:', error);
                showLicenseError(error.message || 'Lisans doğrulama sırasında bir hata oluştu.');
            } finally {
                // Reset button state
                verifyBtn.disabled = false;
                verifyBtnText.textContent = 'Lisansı Doğrula';
                verifySpinner.classList.add('hidden');
            }
        }

        function updateVerificationStep(stepId, status) {
            const step = document.getElementById(stepId);
            if (!step) return;
            
            const icon = step.querySelector('i');
            if (!icon) return;
            
            // Remove all status classes
            step.classList.remove('pending', 'active', 'completed', 'failed');
            step.classList.add(status);
            
            // Update icon
            icon.classList.remove('animate-spin');
            
            switch (status) {
                case 'active':
                    icon.setAttribute('data-lucide', 'loader');
                    icon.classList.add('animate-spin');
                    break;
                case 'completed':
                    icon.setAttribute('data-lucide', 'check-circle');
                    break;
                case 'failed':
                    icon.setAttribute('data-lucide', 'x-circle');
                    break;
            }
            
            // Recreate icons
            lucide.createIcons();
        }

        function validateLicenseFormat(licenseKey) {
            return /^QRMENU-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}$/.test(licenseKey);
        }

        function showLicenseError(message) {
            const errorDiv = document.getElementById('licenseError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
            }
        }

        function showAdminPanel() {
            const overlay = document.getElementById('licenseOverlay');
            const panel = document.getElementById('adminPanel');
            
            if (overlay) overlay.classList.add('hidden');
            if (panel) panel.classList.remove('hidden');
            
            // Initialize admin panel
            if (typeof initializeAdmin === 'function') {
                initializeAdmin();
            }
        }

        function logout() {
            if (confirm('Çıkış yapmak istediğinizden emin misiniz?')) {
                const licenseManager = window.SecureLicenseManager;
                if (licenseManager) {
                    licenseManager.clearStoredLicense();
                }
                location.reload();
            }
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Enhanced security measures
        (function() {
            // Disable right-click context menu
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });

            // Disable F12, Ctrl+Shift+I, Ctrl+U
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                    (e.ctrlKey && e.key === 'u')) {
                    e.preventDefault();
                }
            });

            // Monitor for tampering attempts
            const originalConsoleLog = console.log;
            console.log = function() {
                if (arguments.length > 0 && typeof arguments[0] === 'string') {
                    if (arguments[0].includes('license') || arguments[0].includes('bypass')) {
                        logout();
                        return;
                    }
                }
                originalConsoleLog.apply(console, arguments);
            };

            // Detect developer tools
            let devtools = {open: false, orientation: null};
            const threshold = 160;

            setInterval(function() {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        console.clear();
                        console.log('%cDeveloper tools detected!', 'color: red; font-size: 20px;');
                    }
                } else {
                    devtools.open = false;
                }
            }, 500);
        })();
    </script>
</body>
</html>